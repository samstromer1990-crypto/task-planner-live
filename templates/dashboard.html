<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Task Planner Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
Â  --bg: #f4f1fb;
Â  --panel: #fff;
Â  --muted: #7b7f88;
Â  --primary: #7c5cff;
Â  --accent: #bfa8ff;
Â  --radius: 14px;
Â  --shadow: 0 12px 40px rgba(22,18,32,0.08);
Â  --dark-bg: #0f1720;
Â  --dark-panel: #1f2335;
Â  --ease: cubic-bezier(.2,.9,.2,1);
}

/* Custom badges for priorities/status */
.badge-status { font-size:11px; padding:3px 7px; border-radius:6px; font-weight:700; }
.badge-pending { background-color: #ffe5e5; color: #cc3333; }
.badge-completed { background-color: #e6ffe6; color: #33cc33; }
.dark-mode .badge-pending { background-color: #3f1e1e; color: #ff9999; }
.dark-mode .badge-completed { background-color: #1e3f1e; color: #99ff99; }

/* base */
*{box-sizing:border-box}
body{
Â  margin:0;
Â  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
Â  background:var(--bg);
Â  color:#111827;
Â  -webkit-font-smoothing:antialiased;
Â  -moz-osx-font-smoothing:grayscale;
Â  transition: background .24s var(--ease), color .24s var(--ease);
}

/* app layout */
.app { min-height:100vh; display:flex; align-items:stretch; position:relative; }

/* backdrop overlay */
.backdrop {
Â  position:fixed; inset:0; background: rgba(3,6,23,0.55);
Â  opacity:0; visibility:hidden; transition:opacity .22s var(--ease);
Â  z-index: 40;
}
.backdrop.show { opacity:1; visibility:visible; }

/* sidebar overlay slide */
.sidebar {
Â  position:fixed; left:0; top:0; bottom:0;
Â  width: 260px;
Â  background: linear-gradient(180deg, var(--panel), #fbf8ff);
Â  border-right: 1px solid rgba(124,92,255,0.06);
Â  padding:22px;
Â  transform: translateX(-110%);
Â  transition: transform .34s var(--ease), box-shadow .24s var(--ease);
Â  z-index: 50;
Â  box-shadow: var(--shadow);
Â  display:flex; flex-direction:column; gap:14px;
Â  will-change: transform;
}
.sidebar.open { transform: translateX(0); }

/* sidebar items */
.logo { display:flex; gap:10px; align-items:center; }
.logo .mark { width:40px; height:40px; border-radius:10px; display:flex;align-items:center;justify-content:center; color:#fff; font-weight:700; background:linear-gradient(135deg,var(--primary),var(--accent)); box-shadow:0 8px 24px rgba(124,92,255,0.12); }
.navlink { display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px; color:var(--muted); text-decoration:none; font-weight:600; transition: background .18s var(--ease), color .18s var(--ease); }
.navlink.active { color:var(--primary); background: linear-gradient(90deg, rgba(124,92,255,0.08), rgba(191,168,255,0.03)); }

/* container & header */
.container-main { flex:1; padding:22px 36px; margin-left:0; width:100%; transition: filter .18s var(--ease); }
.header { display:flex; justify-content:space-between; align-items:flex-start; gap:12px; margin-bottom:18px; }
.header .controls { display:flex; gap:10px; align-items:center; }

/* animated micro interactions */
.btn { transition: transform .12s var(--ease), box-shadow .12s var(--ease); }
.btn:hover { transform: translateY(-2px); }
.btn:active { transform: translateY(0); }
.btn-primary { background:var(--primary); border-color:var(--primary); }
.btn-primary:hover { background: #6a49e6; border-color: #6a49e6; } /* Darker purple on hover */
.btn-primary:focus { box-shadow: 0 0 0 0.25rem rgba(124, 92, 255, 0.25); }

/* hero */
.hero { display:flex; gap:18px; background:linear-gradient(90deg, rgba(124,92,255,0.06), rgba(191,168,255,0.02)); padding:18px; border-radius:12px; box-shadow:var(--shadow); align-items:center; transform-origin: center top; animation: appearUp .36s var(--ease) both; }
.metrics { display:flex; gap:12px; margin-top:14px; }
.metric { background:var(--panel); border-radius:10px; padding:12px; box-shadow: var(--shadow); flex:1; transform-origin:center; }
.metric h6{ margin:0; color:var(--muted); font-size:13px; font-weight:600; }
.metric h3{ margin:6px 0 0; }

/* grid layout */
.grid { display:grid; grid-template-columns: 1fr 340px; gap:18px; margin-top:18px; }
.content-col { display:flex; flex-direction:column; gap:14px; }

/* card panel */
.card-panel { background:var(--panel); border-radius:12px; padding:18px; box-shadow: var(--shadow); transform-origin:center; }

/* task row with animation */
.task-row {
Â  display:flex; justify-content:space-between; align-items:center; gap:12px; padding:12px; border-radius:10px; margin-bottom:10px;
Â  background:linear-gradient(180deg,#fff,#fbf8ff);
Â  transition: transform .18s var(--ease), box-shadow .18s var(--ease), opacity .18s var(--ease);
Â  will-change: transform, opacity;
}
.task-row:hover { transform: translateY(-4px); box-shadow:0 18px 40px rgba(22,18,32,0.06); }

.task-left { display:flex; gap:10px; align-items:center; flex:1; }
.task-info .title { font-weight:600; font-size:16px; }
.task-info .sub { font-size:13px; color:var(--muted); }
.task-row .completed .task-info .title { text-decoration: line-through; opacity: 0.6; }

/* avatar for tasks (initials) */
.avatar { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; background:#ebe6f8; color:var(--primary); font-weight:700; font-size:14px; flex-shrink:0; }

/* entry animation for elements */
@keyframes appearUp {
Â  from { opacity: 0; transform: translateY(10px) scale(.997); }
Â  toÂ  Â { opacity: 1; transform: translateY(0) scale(1); }
}
.animate-in { animation: appearUp .36s var(--ease) both; }

/* fade+scale for modal content (Bootstrap uses fade) */
.modal.fade .modal-dialog { transform: translateY(-6px) scale(.995); transition: transform .24s var(--ease); }
.modal.fade.show .modal-dialog { transform: translateY(0) scale(1); }

/* calendar */
.calendar-widget-modern {
Â  background:var(--panel); border-radius:12px; padding:18px; box-shadow: var(--shadow); transform-origin:center;
}
.calendar-grid-modern {
Â  display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 14px; margin-top: 10px;
}
.calendar-day-modern {
Â  padding: 6px 0; cursor: pointer; border-radius: 6px; transition: background-color 0.2s, transform 0.2s; font-weight: 500;
}
.calendar-day-modern:hover { background-color: var(--bg); transform: scale(1.05); }
.calendar-day-modern.today {
Â  background-color: var(--primary); color: #fff; font-weight: 700; box-shadow: 0 4px 10px rgba(124, 92, 255, 0.3);
}

/* small helpers */
.small { font-size:13px; color:var(--muted); }

/* dark mode */
.dark-mode {
Â  background: var(--dark-bg);
Â  color:#e5e7eb;
}
.dark-mode .sidebar { background: linear-gradient(180deg,var(--dark-panel), #0d1116); border-right-color: rgba(255,255,255,0.03); }
.dark-mode .card-panel, .dark-mode .metric, .dark-mode .task-row, .dark-mode .calendar-day-modern { background: var(--dark-panel); border-color:#222631; color:#e5e7eb; box-shadow:none; }
.dark-mode .task-info .sub, .dark-mode .small { color:#9ca3af; }
.dark-mode .badge-pri { filter: brightness(.95); }
.dark-mode .hero { background: linear-gradient(90deg, rgba(124,92,255,0.1), rgba(191,168,255,0.05)); }
.dark-mode .avatar { background:#3f3261; color:var(--accent); }
.dark-mode .btn-outline-secondary { color: #ccc; border-color: #333; }
.dark-mode .btn-outline-secondary:hover { background: #333; color: #fff; }

/* delete animation (fade out) */
.fade-out { animation: fadeOut .26s ease forwards; }
@keyframes fadeOut {
Â  to { opacity:0; transform: translateY(-8px) scale(.995); height:0; margin:0; padding:0; }
}

/* responsive */
@media (max-width:980px){ .grid{ grid-template-columns: 1fr; } .container-main{ padding:16px; } }
</style>
</head>
<body>
<div class="app">

Â  Â  <aside class="sidebar" id="sidebar" aria-hidden="true">
Â  Â  <div class="logo">
Â  Â  Â  <div class="mark">T</div>
Â  Â  Â  <div>
Â  Â  Â  Â  <div style="font-weight:700">Task Planner</div>
Â  Â  Â  Â  <div style="font-size:12px;color:var(--muted)">Daily focus</div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div style="border-top:1px solid rgba(124,92,255,0.05); margin:14px 0; padding-top:14px;">
Â  Â  Â  <div style="font-size:14px; font-weight:600; margin-bottom:10px;">Quick Stats</div>
Â  Â  Â  <div class="card-panel p-3">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="small">Total Tasks: <span class="fw-bold">{{ tasks|length }}</span></div>
Â  Â  Â  Â  <div class="small">Completed: <span class="text-success fw-bold">{{ tasks | selectattr('completed', 'equalto', true) | list | length }}</span></div>
Â  Â  Â  Â  <div class="small">Pending: <span class="text-danger fw-bold">{{ tasks | selectattr('completed', 'equalto', false) | list | length }}</span></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div style="margin-top:auto;">
Â  Â  Â  <a class="navlink" href="/logout">Logout</a>
Â  Â  </div>
Â  </aside>

Â  Â  <div class="backdrop" id="backdrop" tabindex="-1" aria-hidden="true"></div>

Â  Â  <main class="container-main" id="mainContent">
Â  Â  <div class="header">
Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 style="margin:0 0 6px">Welcome back, <span id="userNameDisplay"></span> ğŸ‘‹</h2>
Â  Â  Â  Â  <div style="color:var(--muted)">Here's your overview for today</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <button id="openSidebar" class="btn btn-outline-secondary btn-sm" title="Open menu">â˜°</button>
Â  Â  Â  Â  <button id="themeToggle" class="btn btn-outline-secondary btn-sm">Dark</button>
Â  Â  Â  Â  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addTaskModal">+ Add Task</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  {% with messages = get_flashed_messages(with_categories=true) %}
Â  Â  Â  {% if messages %}
Â  Â  Â  Â  <div class="animate-in" style="margin-bottom:18px;">
Â  Â  Â  Â  Â  {% for category, message in messages %}
Â  Â  Â  Â  Â  Â  <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert" style="border-radius:10px;">
Â  Â  Â  Â  Â  Â  Â  {{ message }}
Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  </div>
Â  Â  Â  {% endif %}
Â  Â  {% endwith %}

Â  Â  Â  Â  <section class="hero">
Â  Â  Â  <div style="flex:1">
Â  Â  Â  Â  Â  <h3 style="margin:0 0 8px">Task Completion Summary</h3>
Â  Â  Â  Â  Â  <div style="color:var(--muted)">Quick glance at progress and what's due.</div>

Â  Â  Â  Â  <div class="metrics">
Â  Â  Â  Â  Â  <div class="metric"><h6>Total Tasks</h6><h3 id="totalShow">{{ tasks|length }}</h3></div>
Â  Â  Â  Â  Â  <div class="metric"><h6>Completed</h6><h3 id="doneShow" class="text-success">{{ tasks | selectattr('completed', 'equalto', true) | list | length }}</h3></div>
Â  Â  Â  Â  Â  <div class="metric"><h6>Pending</h6><h3 id="pendingShow" class="text-danger">{{ tasks | selectattr('completed', 'equalto', false) | list | length }}</h3></div>
Â  Â  Â  Â  Â  <div class="metric">
Â  Â  Â  Â  Â  Â  <h6>Completion Rate</h6>
Â  Â  Â  Â  Â  Â  {% set total = tasks|length %}
Â  Â  Â  Â  Â  Â  {% set done = tasks | selectattr('completed', 'equalto', true) | list | length %}
Â  Â  Â  Â  Â  Â  {% set pct = (done / total * 100) | round(0) if total > 0 else 0 %}
Â  Â  Â  Â  Â  Â  <div class="progress" style="height:12px;border-radius:10px;margin-top:8px;">
Â  Â  Â  Â  Â  Â  Â  <div id="progressBar" class="progress-bar" style="width:{{ pct }}%">{{ pct }}%</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <div class="grid">
Â  Â  Â  <div class="content-col">
Â  Â  Â  Â  <div class="card-panel animate-in">
Â  Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
Â  Â  Â  Â  Â  Â  <h5 style="margin:0">Your Active Tasks</h5>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% for task in tasks %}
Â  Â  Â  Â  Â  <div class="task-row {% if task.completed %}completed{% endif %} animate-in">
Â  Â  Â  Â  Â  Â  <div class="task-left">
Â  Â  Â  Â  Â  Â  Â  <div class="avatar">T</div>
Â  Â  Â  Â  Â  Â  Â  <div class="task-info">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="title">{{ task.task }}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="sub">
Â  Â  Â  Â  Â  Â  Â  Â  Â  {% if task.raw_reminder_time %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Due: {{ task.raw_reminder_time | replace('Z', '') | truncate(16, True, '') }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  No Reminder Set
Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div style="display:flex;gap:8px;align-items:center">
Â  Â  Â  Â  Â  Â  Â  <form action="/update-time/{{ task.id }}" method="POST" class="d-flex align-items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="datetime-local" name="reminder_time"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value="{{ task.raw_reminder_time | replace('Z', '') | truncate(16, True, '') }}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="form-control form-control-sm" style="max-width:180px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline-secondary btn-sm" title="Save Reminder">ğŸ’¾</button>
Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  {% if not task.completed %}
Â  Â  Â  Â  Â  Â  Â  <a href="/complete/{{ task.id }}" class="btn btn-primary btn-sm" title="Mark Complete">Done</a>
Â  Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  <span class="badge badge-status badge-completed">Completed</span>
Â  Â  Â  Â  Â  Â  Â  {% endif %}

Â  Â  Â  Â  Â  Â  Â  <a href="/delete/{{ task.id }}"
Â  Â  Â  Â  Â  Â  Â  Â class="btn btn-sm btn-outline-danger"
Â  Â  Â  Â  Â  Â  Â  Â onclick="return confirm('Are you sure you want to delete the task: {{ task.task | e }}?');"
Â  Â  Â  Â  Â  Â  Â  Â title="Delete Task">
Â  Â  Â  Â  Â  Â  Â  Â âŒ
Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  {% endfor %}

Â  Â  Â  Â  Â  {% if tasks|length == 0 %}
Â  Â  Â  Â  Â  <div class="alert alert-light border text-center mt-3" style="border-radius:10px;">No tasks yet. Click "+ Add Task" to create one.</div>
Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-panel animate-in">
Â  Â  Â  Â  Â  <h5 style="margin:0 0 8px">AI Assistant ğŸ¤–</h5>
Â  Â  Â  Â  Â  <p class="small">Ask anything. AI will help extract tasks or chat.</p>

Â  Â  Â  Â  Â  <div class="input-group mb-2">
Â  Â  Â  Â  Â  Â  <input id="ai_input" class="form-control" placeholder="e.g., Remind me to study physics tomorrow at 4 PM">
Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" onclick="sendToAI()">Ask</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <pre id="ai_output" class="p-3" style="min-height:100px; white-space: pre-wrap; background:var(--bg); border-radius:10px; border:1px solid rgba(124,92,255,0.05);"></pre>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <aside>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="calendar-widget-modern animate-in" style="margin-bottom:12px">
Â  Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div style="color:var(--muted)" class="small">Current Date</div>
Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700">November 2025</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="small">Add Event</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="calendar-grid-modern">
Â  Â  Â  Â  Â  Â  <div style="color:var(--muted); font-weight:600;">Mo</div>
Â  Â  Â  Â  Â  Â  <div style="color:var(--muted); font-weight:600;">Tu</div>
Â  Â  Â  Â  Â  Â  <div style="color:var(--muted); font-weight:600;">We</div>
Â  Â  Â  Â  Â  Â  <div style="color:var(--muted); font-weight:600;">Th</div>
Â  Â  Â  Â  Â  Â  <div style="color:var(--muted); font-weight:600;">Fr</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="color:var(--muted); font-weight:600;">Sa</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="color:#dc3545; font-weight:600;">Su</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="grid-column: 6;">1</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="color: #dc3545;">2</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">3</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">4</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">5</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">6</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">7</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">8</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="color: #dc3545;">9</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">10</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">11</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">12</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">13</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">14</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">15</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="color: #dc3545;">16</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">17</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">18</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">19</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">20</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">21</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">22</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="color: #dc3545;">23</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">24</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">25</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">26</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">27</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern today">28</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern">29</div>
Â  Â  Â  Â  Â  Â  <div class="calendar-day-modern" style="color: #dc3545;">30</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-panel animate-in" style="text-align:center">
Â  Â  Â  Â  Â  <div style="display:flex;align-items:center;gap:10px;justify-content:center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="avatar" id="userAvatar" style="width:40px;height:40px;border-radius:50%;">U</div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700" id="userNameProfile">User</div>
Â  Â  Â  Â  Â  Â  Â  <div style="color:var(--muted)" class="small">Task Planner User</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>
Â  Â  </div>
Â  </main>
</div>

<div class="modal fade" id="addTaskModal" tabindex="-1">
Â  <div class="modal-dialog modal-sm">
Â  Â  <div class="modal-content" style="border-radius:12px">
Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  <h5 class="modal-title">Add Task</h5>
Â  Â  Â  Â  <button class="btn-close" data-bs-dismiss="modal"></button>
Â  Â  Â  Â  </div>

Â  Â  Â  <form action="/add-task" method="POST">
Â  Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  Â  <label class="form-label small">Task Name</label>
Â  Â  Â  Â  Â  <input type="text" name="task_name" class="form-control mb-3" required>

Â  Â  Â  Â  Â  <label class="form-label small">Reminder Time</label>
Â  Â  Â  Â  Â  <input type="datetime-local" name="reminder_time" class="form-control">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  Â  <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
Â  Â  Â  Â  Â  <button class="btn btn-primary">Add Task</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </form>
Â  Â  </div>
Â  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Function to generate initials from a name
function getInitials(name) {
    if (!name) return 'U';
    const parts = name.trim().split(/\s+/);
    if (parts.length === 1) return parts[0].substring(0, 1).toUpperCase();
    return (parts[0].substring(0, 1) + parts[parts.length - 1].substring(0, 1)).toUpperCase();
}

// Function to handle the username prompt and storage
function checkAndSetUsername() {
    let userName = localStorage.getItem('taskPlannerUserName');
    
    // If no name is found, prompt the user
    if (!userName) {
        let input = prompt("Welcome! Please enter your name:");
        if (input && input.trim() !== '') {
            userName = input.trim();
            localStorage.setItem('taskPlannerUserName', userName);
        } else {
            userName = 'User'; // Default name
        }
    }
    
    // Update all displays
    document.getElementById('userNameDisplay').textContent = userName;
    document.getElementById('userNameProfile').textContent = userName;
    document.getElementById('userAvatar').textContent = getInitials(userName);
}

// Sidebar and Theme Toggling
document.addEventListener('DOMContentLoaded', ()=> {
Â  checkAndSetUsername(); // CALL THE NEW FUNCTION ON LOAD

Â  const sidebar = document.getElementById('sidebar');
Â  const backdrop = document.getElementById('backdrop');
Â  const openSidebarBtn = document.getElementById('openSidebar');
Â  const themeToggle = document.getElementById('themeToggle');

Â  // sidebar open/close handlers
Â  function openSidebar(){ sidebar.classList.add('open'); backdrop.classList.add('show'); sidebar.setAttribute('aria-hidden','false'); }
Â  function closeSidebar(){ sidebar.classList.remove('open'); backdrop.classList.remove('show'); sidebar.setAttribute('aria-hidden','true'); }
Â  openSidebarBtn.addEventListener('click', openSidebar);
Â  backdrop.addEventListener('click', closeSidebar);
Â  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeSidebar(); });

Â  // theme toggle
Â  themeToggle.addEventListener('click', ()=>{
Â  Â  document.body.classList.toggle('dark-mode');
Â  Â  themeToggle.textContent = document.body.classList.contains('dark-mode') ? 'Light' : 'Dark';
Â  });
});

// Original AI Functionality
async function sendToAI() {
    const text = document.getElementById("ai_input").value;
    const aiOutput = document.getElementById("ai_output");
    aiOutput.innerText = "Processing...";

    try {
        const res = await fetch("/ai-process", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user_input: text })
        });

        const data = await res.json();

        // If AI returns an error â†’ show it
        if (data.type === "error") {
            aiOutput.innerText = "âŒ Error:\n" + (data.message || JSON.stringify(data, null, 2));
            return;
        }

        // If AI returns a general conversation â†’ show it
        if (data.action !== "add") {
             // For general chat, display the response cleanly
            const chatResponse = data.response || JSON.stringify(data, null, 2);
            aiOutput.innerText = "ğŸ¤– Assistant:\n" + chatResponse;
            return;
        }

        // If AI successfully added a task
        // Clean up the ISO string for display (remove Z and milliseconds)
        const timeDisplay = data.reminder_time
            ? data.reminder_time.replace('Z', '').substring(0, 16)
            : 'None';

        aiOutput.innerText =
            "âœ… Task added:\n" +
            "Task: " + data.task + "\n" +
            "Time (UTC): " + timeDisplay;

        // Refresh automatically to show the new task
        setTimeout(() => {
            window.location.reload();
        }, 800);

    } catch (e) {
        aiOutput.innerText = "âŒ Network or unexpected error: " + e.message;
    }
}
</script>

</body>
</html>
